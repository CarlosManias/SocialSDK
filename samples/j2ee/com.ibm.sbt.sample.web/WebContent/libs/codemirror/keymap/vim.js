/*  (c) Copyright IBM Corp. 2010 - Licensed under the Apache License, Version 2.0 */

(function(){"use strict";var _1=[{keys:["Left"],type:"keyToKey",toKeys:["h"]},{keys:["Right"],type:"keyToKey",toKeys:["l"]},{keys:["Up"],type:"keyToKey",toKeys:["k"]},{keys:["Down"],type:"keyToKey",toKeys:["j"]},{keys:["Space"],type:"keyToKey",toKeys:["l"]},{keys:["Backspace"],type:"keyToKey",toKeys:["h"]},{keys:["Ctrl-Space"],type:"keyToKey",toKeys:["W"]},{keys:["Ctrl-Backspace"],type:"keyToKey",toKeys:["B"]},{keys:["Shift-Space"],type:"keyToKey",toKeys:["w"]},{keys:["Shift-Backspace"],type:"keyToKey",toKeys:["b"]},{keys:["Ctrl-n"],type:"keyToKey",toKeys:["j"]},{keys:["Ctrl-p"],type:"keyToKey",toKeys:["k"]},{keys:["Ctrl-["],type:"keyToKey",toKeys:["Esc"]},{keys:["Ctrl-c"],type:"keyToKey",toKeys:["Esc"]},{keys:["s"],type:"keyToKey",toKeys:["c","l"]},{keys:["S"],type:"keyToKey",toKeys:["c","c"]},{keys:["Home"],type:"keyToKey",toKeys:["0"]},{keys:["End"],type:"keyToKey",toKeys:["$"]},{keys:["PageUp"],type:"keyToKey",toKeys:["Ctrl-b"]},{keys:["PageDown"],type:"keyToKey",toKeys:["Ctrl-f"]},{keys:["h"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:["l"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:["j"],type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:["k"],type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:["w"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:["W"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:["e"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:["E"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:["b"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:["B"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:["g","e"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:["g","E"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:["Ctrl-f"],type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:["Ctrl-b"],type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:["g","g"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true}},{keys:["G"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true}},{keys:["0"],type:"motion",motion:"moveToStartOfLine"},{keys:["^"],type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["$"],type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:["%"],type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true}},{keys:["f","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:["F","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:["t","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:["T","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:["'","character"],type:"motion",motion:"goToMark"},{keys:["`","character"],type:"motion",motion:"goToMark"},{keys:["|"],type:"motion",motion:"moveToColumn",motionArgs:{}},{keys:["d"],type:"operator",operator:"delete"},{keys:["y"],type:"operator",operator:"yank"},{keys:["c"],type:"operator",operator:"change",operatorArgs:{enterInsertMode:true}},{keys:[">"],type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:["<"],type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:["g","~"],type:"operator",operator:"swapcase"},{keys:["n"],type:"motion",motion:"findNext"},{keys:["N"],type:"motion",motion:"findPrev"},{keys:["x"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:["X"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:["D"],type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["Y"],type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["C"],type:"operatorMotion",operator:"change",operatorArgs:{enterInsertMode:true},motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["~"],type:"operatorMotion",operator:"swapcase",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:["a"],type:"action",action:"enterInsertMode",actionArgs:{insertAt:"charAfter"}},{keys:["A"],type:"action",action:"enterInsertMode",actionArgs:{insertAt:"eol"}},{keys:["i"],type:"action",action:"enterInsertMode"},{keys:["I"],type:"action",action:"enterInsertMode",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["o"],type:"action",action:"newLineAndEnterInsertMode",actionArgs:{after:true}},{keys:["O"],type:"action",action:"newLineAndEnterInsertMode",actionArgs:{after:false}},{keys:["v"],type:"action",action:"toggleVisualMode"},{keys:["V"],type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:["J"],type:"action",action:"joinLines"},{keys:["p"],type:"action",action:"paste",actionArgs:{after:true}},{keys:["P"],type:"action",action:"paste",actionArgs:{after:false}},{keys:["r","character"],type:"action",action:"replace"},{keys:["u"],type:"action",action:"undo"},{keys:["Ctrl-r"],type:"action",action:"redo"},{keys:["m","character"],type:"action",action:"setMark"},{keys:["\"","character"],type:"action",action:"setRegister"},{keys:[",","/"],type:"action",action:"clearSearchHighlight"},{keys:["a","character"],type:"motion",motion:"textObjectManipulation"},{keys:["i","character"],type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:["/"],type:"search",searchArgs:{forward:true,querySrc:"prompt"}},{keys:["?"],type:"search",searchArgs:{forward:false,querySrc:"prompt"}},{keys:["*"],type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor"}},{keys:["#"],type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor"}},{keys:[":"],type:"ex"}];var _2=function(){var _3=/[A-Za-z]/;var _4=/[\d]/;var _5=/\s/;var _6=[(/\w/),(/[^\w\s]/)],_7=[(/\S/)];function _8(_9,_a){var _b=[];for(var i=_9;i<_9+_a;i++){_b.push(String.fromCharCode(i));}return _b;};var _c=_8(65,26);var _d=_8(97,26);var _e=_8(48,10);var _f="~`!@#$%^&*()_-+=[{}]\\|/?.,<>:;\"'";var _10=_f.split("");var _11=["Left","Right","Up","Down","Space","Backspace","Esc","Home","End","PageUp","PageDown"];var _12=_c.concat(_d).concat(_e);var _13=_c.concat(_d).concat(_e).concat("-\"".split(""));function _14(k){return _3.test(k);};function _15(cm,_16){return _16>=0&&_16<cm.lineCount();};function _17(k){return (/^[a-z]$/).test(k);};function _18(k){return "()[]{}".indexOf(k)!=-1;};function _19(k){return _4.test(k);};function _1a(k){return (/^[A-Z]$/).test(k);};function _1b(k){return (/^[\w]$/).test(k);};function _1c(k){return _5.test(k);};function _1d(k){return (/^\s*$/).test(k);};function _1e(x,_1f,end){return x>=_1f&&x<=end;};function _20(val,arr){for(var i=0;i<arr.length;i++){if(arr[i]==val){return true;}}return false;};var _21;function _22(){if(!_21){_21={searchQuery:null,searchIsReversed:false,registerController:new _23({})};}return _21;};function _24(cm){if(!cm.vimState){cm.vimState={inputState:new _25(),lastHPos:-1,lastMotion:null,marks:{},visualMode:false,visualLine:false};}return cm.vimState;};var _26={buildKeyMap:function(){},getRegisterController:function(){return _22().registerController;},clearVimGlobalState_:function(){_21=null;},map:function(lhs,rhs){_27.map(lhs,rhs);},maybeInitState:function(cm){_24(cm);},handleKey:function(cm,key){var _28;var vim=_24(cm);if(key=="Esc"){vim.inputState.reset();if(vim.visualMode){_29(cm,vim);}return;}if(vim.visualMode&&_2a(cm.getCursor("head"),cm.getCursor("anchor"))){_29(cm,vim);}if(!vim.visualMode&&!_2a(cm.getCursor("head"),cm.getCursor("anchor"))){vim.visualMode=true;vim.visualLine=false;}if(key!="0"||(key=="0"&&vim.inputState.getRepeat()===0)){_28=_2b.matchCommand(key,_1,vim);}if(!_28){if(_19(key)){vim.inputState.pushRepeatDigit(key);}return;}if(_28.type=="keyToKey"){for(var i=0;i<_28.toKeys.length;i++){this.handleKey(cm,_28.toKeys[i]);}}else{_2b.processCommand(cm,vim,_28);}}};function _25(){this.reset();};_25.prototype.reset=function $DBbU_(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null;};_25.prototype.pushRepeatDigit=function $DBbV_(n){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(n);}else{this.motionRepeat=this.motionRepeat.concat(n);}};_25.prototype.getRepeat=function $DBbW_(){var _2c=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){_2c=1;if(this.prefixRepeat.length>0){_2c*=parseInt(this.prefixRepeat.join(""),10);}if(this.motionRepeat.length>0){_2c*=parseInt(this.motionRepeat.join(""),10);}}return _2c;};function _2d(_2e,_2f){this.clear();if(_2e){this.set(_2e,_2f);}};_2d.prototype={set:function(_30,_31){this.text=_30;this.linewise=!!_31;},append:function(_32,_33){if(_33||this.linewise){this.text+="\n"+_32;this.linewise=true;}else{this.text+=_32;}},clear:function(){this.text="";this.linewise=false;},toString:function(){return this.text;}};function _23(_34){this.registers=_34;this.unamedRegister=_34["\""]=new _2d();};_23.prototype={pushText:function(_35,_36,_37,_38){var _39=this.isValidRegister(_35)?this.getRegister(_35):null;if(!_39){switch(_36){case "yank":this.registers["0"]=new _2d(_37,_38);break;case "delete":case "change":if(_37.indexOf("\n")==-1){this.registers["-"]=new _2d(_37,_38);}else{this.shiftNumericRegisters_();this.registers["1"]=new _2d(_37,_38);}break;}this.unamedRegister.set(_37,_38);return;}var _3a=_1a(_35);if(_3a){_39.append(_37,_38);this.unamedRegister.append(_37,_38);}else{_39.set(_37,_38);this.unamedRegister.set(_37,_38);}},getRegister:function(_3b){if(!this.isValidRegister(_3b)){return this.unamedRegister;}_3b=_3b.toLowerCase();if(!this.registers[_3b]){this.registers[_3b]=new _2d();}return this.registers[_3b];},isValidRegister:function(_3c){return _3c&&_20(_3c,_13);},shiftNumericRegisters_:function(){for(var i=9;i>=2;i--){this.registers[i]=this.getRegister(""+(i-1));}}};var _2b={matchCommand:function(key,_3d,vim){var _3e=vim.inputState;var _3f=_3e.keyBuffer.concat(key);for(var i=0;i<_3d.length;i++){var _40=_3d[i];if(_41(_3f,_40.keys)){if(_3f.length<_40.keys.length){_3e.keyBuffer.push(key);return null;}else{if(_3e.operator&&_40.type=="action"){continue;}if(_40.keys[_3f.length-1]=="character"){_3e.selectedCharacter=_3f[_3f.length-1];}_3e.keyBuffer=[];return _40;}}}_3e.keyBuffer=[];return null;},processCommand:function(cm,vim,_42){switch(_42.type){case "motion":this.processMotion(cm,vim,_42);break;case "operator":this.processOperator(cm,vim,_42);break;case "operatorMotion":this.processOperatorMotion(cm,vim,_42);break;case "action":this.processAction(cm,vim,_42);break;case "search":this.processSearch(cm,vim,_42);break;case "ex":case "keyToEx":this.processEx(cm,vim,_42);break;default:break;}},processMotion:function(cm,vim,_43){vim.inputState.motion=_43.motion;vim.inputState.motionArgs=_44(_43.motionArgs);this.evalInput(cm,vim);},processOperator:function(cm,vim,_45){var _46=vim.inputState;if(_46.operator){if(_46.operator==_45.operator){_46.motion="expandToLine";_46.motionArgs={linewise:true};this.evalInput(cm,vim);return;}else{_46.reset();}}_46.operator=_45.operator;_46.operatorArgs=_44(_45.operatorArgs);if(vim.visualMode){this.evalInput(cm,vim);}},processOperatorMotion:function(cm,vim,_47){var _48=vim.visualMode;var _49=_44(_47.operatorMotionArgs);if(_49){if(_48&&_49.visualLine){vim.visualLine=true;}}this.processOperator(cm,vim,_47);if(!_48){this.processMotion(cm,vim,_47);}},processAction:function(cm,vim,_4a){var _4b=vim.inputState;var _4c=_4b.getRepeat();var _4d=!!_4c;var _4e=_44(_4a.actionArgs)||{};if(_4b.selectedCharacter){_4e.selectedCharacter=_4b.selectedCharacter;}if(_4a.operator){this.processOperator(cm,vim,_4a);}if(_4a.motion){this.processMotion(cm,vim,_4a);}if(_4a.motion||_4a.operator){this.evalInput(cm,vim);}_4e.repeat=_4c||1;_4e.repeatIsExplicit=_4d;_4e.registerName=_4b.registerName;_4b.reset();vim.lastMotion=null,_4f[_4a.action](cm,_4e,vim);},processSearch:function(cm,vim,_50){if(!cm.getSearchCursor){return;}var _51=_50.searchArgs.forward;_52(cm).setReversed(!_51);var _53=(_51)?"/":"?";function _54(_55,_56,_57){_15d(cm,_55,_56,_57);_2b.processMotion(cm,vim,{type:"motion",motion:"findNext"});};function _58(_59){_54(_59,true,true);};switch(_50.searchArgs.querySrc){case "prompt":_5a(cm,_58,_53,_5b);break;case "wordUnderCursor":var _5c=_5d(cm,false,true,false,true);var _5e=true;if(!_5c){_5c=_5d(cm,false,true,false,false);_5e=false;}if(!_5c){return;}var _5f=cm.getLine(_5c.start.line).substring(_5c.start.ch,_5c.end.ch+1);if(_5e){_5f="\\b"+_5f+"\\b";}else{_5f=_60(_5f);}cm.setCursor(_5c.start);_54(_5f,true,false);break;}},processEx:function(cm,vim,_61){function _62(_63){_27.processCommand(cm,_63);};if(_61.type=="keyToEx"){_27.processCommand(cm,_61.exArgs.input);}else{_5a(cm,_62,":");}},evalInput:function(cm,vim){var _64=vim.inputState;var _65=_64.motion;var _66=_64.motionArgs||{};var _67=_64.operator;var _68=_64.operatorArgs||{};var _69=_64.registerName;var _6a=cm.getCursor("head");var _6b=cm.getCursor("anchor");var _6c=_6d(_6a);var _6e=_6d(_6c);var _6f;var _70;if(_66.repeat!==undefined){_70=_64.motionArgs.repeat;}else{_70=_64.getRepeat();}if(_70>0&&_66.explicitRepeat){_66.repeatIsExplicit=true;}else{if(_66.noRepeat||(!_66.explicitRepeat&&_70===0)){_70=1;_66.repeatIsExplicit=false;}}if(_64.selectedCharacter){_66.selectedCharacter=_68.selectedCharacter=_64.selectedCharacter;}_66.repeat=_70;_64.reset();if(_65){var _71=_72[_65](cm,_66,vim);vim.lastMotion=_72[_65];if(!_71){return;}if(_71 instanceof Array){_6c=_71[0];_6f=_71[1];}else{_6f=_71;}if(!_6f){_6f={ch:_6c.ch,line:_6c.line};}if(vim.visualMode){if(_73(_6b,_6a)&&(_2a(_6b,_6f)||_73(_6f,_6b))){_6b.ch+=1;}else{if(_73(_6a,_6b)&&(_2a(_6b,_6f)||_73(_6b,_6f))){_6b.ch-=1;}}_6a=_6f;if(vim.visualLine){if(_73(_6b,_6a)){_6b.ch=0;_6a.ch=_74(cm,_6a.line);}else{_6a.ch=0;_6b.ch=_74(cm,_6b.line);}}cm.setCursor(_6b);cm.setSelection(_6b,_6a);}else{if(!_67){_6f=_75(cm,_6f);cm.setCursor(_6f.line,_6f.ch);}}}if(_67){var _76=false;vim.lastMotion=null;_68.repeat=_70;if(vim.visualMode){_6c=_6b;_6f=_6a;_66.inclusive=true;}if(_73(_6f,_6c)){var tmp=_6c;_6c=_6f;_6f=tmp;_76=true;}if(_66.inclusive&&!(vim.visualMode&&_76)){_6f.ch++;}var _77=_66.linewise||(vim.visualMode&&vim.visualLine);if(_77){_78(cm,_6c,_6f);}else{if(_66.forward){_79(cm,_6c,_6f);}}_68.registerName=_69;_68.linewise=_77;_7a[_67](cm,_68,vim,_6c,_6f,_6e);if(vim.visualMode){_29(cm,vim);}if(_68.enterInsertMode){_4f.enterInsertMode(cm);}}}};var _72={expandToLine:function(cm,_7b){var cur=cm.getCursor();return {line:cur.line+_7b.repeat-1,ch:Infinity};},findNext:function(cm,_7c,vim){return _7d(cm,false,_7c.repeat);},findPrev:function(cm,_7e,vim){return _7d(cm,true,_7e.repeat);},goToMark:function(cm,_7f,vim){var _80=vim.marks[_7f.selectedCharacter];if(_80){return _80.find();}return null;},moveByCharacters:function(cm,_81){var cur=cm.getCursor();var _82=_81.repeat;var ch=_81.forward?cur.ch+_82:cur.ch-_82;return {line:cur.line,ch:ch};},moveByLines:function(cm,_83,vim){var _84=cm.getCursor().ch;switch(vim.lastMotion){case this.moveByLines:case this.moveToColumn:case this.moveToEol:_84=vim.lastHPos;break;default:vim.lastHPos=_84;}var cur=cm.getCursor();var _85=_83.repeat;var _86=_83.forward?cur.line+_85:cur.line-_85;if(_86<0||_86>cm.lineCount()-1){return null;}return {line:_86,ch:_84};},moveByPage:function(cm,_87){var _88=cm.getCursor();var _89=_87.repeat;cm.moveV((_87.forward?_89:-_89),"page");var _8a=cm.getCursor();cm.setCursor(_88);return _8a;},moveByWords:function(cm,_8b){return _8c(cm,_8b.repeat,!!_8b.forward,!!_8b.wordEnd,!!_8b.bigWord);},moveTillCharacter:function(cm,_8d){var _8e=_8d.repeat;var _8f=_90(cm,_8e,_8d.forward,_8d.selectedCharacter);var _91=_8d.forward?-1:1;_8f.ch+=_91;return _8f;},moveToCharacter:function(cm,_92){var _93=_92.repeat;return _90(cm,_93,_92.forward,_92.selectedCharacter);},moveToColumn:function(cm,_94,vim){var _95=_94.repeat;vim.lastHPos=_95-1;return _96(cm,_95);},moveToEol:function(cm,_97,vim){var cur=cm.getCursor();vim.lastHPos=Infinity;return {line:cur.line+_97.repeat-1,ch:Infinity};},moveToFirstNonWhiteSpaceCharacter:function(cm){var _98=cm.getCursor();var _99=cm.getLine(_98.line);return {line:_98.line,ch:_9a(cm.getLine(_98.line))};},moveToMatchedSymbol:function(cm,_9b){var _9c=cm.getCursor();var _9d=cm.getLine(_9c.line).charAt(_9c.ch);if(_18(_9d)){return _9e(cm,cm.getCursor(),_9b.symbol);}else{return _9c;}},moveToStartOfLine:function(cm){var _9f=cm.getCursor();return {line:_9f.line,ch:0};},moveToLineOrEdgeOfDocument:function(cm,_a0){var _a1=_a0.forward?cm.lineCount()-1:0;if(_a0.repeatIsExplicit){_a1=_a0.repeat-1;}return {line:_a1,ch:_9a(cm.getLine(_a1))};},textObjectManipulation:function(cm,_a2){var _a3=_a2.selectedCharacter;var _a4=!_a2.textObjectInner;if(!_a5[_a3]){return null;}var tmp=_a5[_a3](cm,_a4);var _a6=tmp.start;var end=tmp.end;return [_a6,end];}};var _7a={change:function(cm,_a7,vim,_a8,_a9){_22().registerController.pushText(_a7.registerName,"change",cm.getRange(_a8,_a9),_a7.linewise);if(_a7.linewise){_a8.ch=_9a(cm.getLine(_a8.line));cm.replaceRange("\n",_a8,_a9);}else{cm.replaceRange("",_a8,_a9);}cm.setCursor(_a8);},"delete":function(cm,_aa,vim,_ab,_ac){_22().registerController.pushText(_aa.registerName,"delete",cm.getRange(_ab,_ac),_aa.linewise);cm.replaceRange("",_ab,_ac);if(_aa.linewise){cm.setCursor(_72.moveToFirstNonWhiteSpaceCharacter(cm));}else{cm.setCursor(_ab);}},indent:function(cm,_ad,vim,_ae,_af){var _b0=_ae.line;var _b1=_af.line;var _b2=(vim.visualMode)?_ad.repeat:1;if(_ad.linewise){_b1--;}for(var i=_b0;i<=_b1;i++){for(var j=0;j<_b2;j++){cm.indentLine(i,_ad.indentRight);}}cm.setCursor(_ae);cm.setCursor(_72.moveToFirstNonWhiteSpaceCharacter(cm));},swapcase:function(cm,_b3,vim,_b4,_b5,_b6){var _b7=cm.getRange(_b4,_b5);var _b8="";for(var i=0;i<_b7.length;i++){var _b9=_b7.charAt(i);_b8+=_1a(_b9)?_b9.toLowerCase():_b9.toUpperCase();}cm.replaceRange(_b8,_b4,_b5);cm.setCursor(_b6);},yank:function(cm,_ba,vim,_bb,_bc,_bd){_22().registerController.pushText(_ba.registerName,"yank",cm.getRange(_bb,_bc),_ba.linewise);cm.setCursor(_bd);}};var _4f={clearSearchHighlight:_be,enterInsertMode:function(cm,_bf){var _c0=(_bf)?_bf.insertAt:null;if(_c0=="eol"){var _c1=cm.getCursor();_c1={line:_c1.line,ch:_74(cm,_c1.line)};cm.setCursor(_c1);}else{if(_c0=="charAfter"){cm.setCursor(_c2(cm.getCursor(),0,1));}}cm.setOption("keyMap","vim-insert");},toggleVisualMode:function(cm,_c3,vim){var _c4=_c3.repeat;var _c5=cm.getCursor();var _c6;if(!vim.visualMode){vim.visualMode=true;vim.visualLine=!!_c3.linewise;if(vim.visualLine){_c5.ch=0;_c6=_75(cm,{line:_c5.line+_c4-1,ch:_74(cm,_c5.line)},true);}else{_c6=_75(cm,{line:_c5.line,ch:_c5.ch+_c4},true);}if(!_c3.repeatIsExplicit&&!vim.visualLine){cm.setCursor(_c6);cm.setSelection(_c6,_c5);}else{cm.setSelection(_c5,_c6);}}else{if(!vim.visualLine&&_c3.linewise){vim.visualLine=true;_c5=cm.getCursor("anchor");_c6=cm.getCursor("head");_c5.ch=_73(_c5,_c6)?0:_74(cm,_c5.line);_c6.ch=_73(_c5,_c6)?_74(cm,_c6.line):0;cm.setSelection(_c5,_c6);}else{_29(cm,vim);}}},joinLines:function(cm,_c7,vim){var _c8,_c9;if(vim.visualMode){_c8=cm.getCursor("anchor");_c9=cm.getCursor("head");_c9.ch=_74(cm,_c9.line)-1;}else{var _ca=Math.max(_c7.repeat,2);_c8=cm.getCursor();_c9=_75(cm,{line:_c8.line+_ca-1,ch:Infinity});}var _cb=0;cm.operation(function(){for(var i=_c8.line;i<_c9.line;i++){_cb=_74(cm,_c8.line);var tmp={line:_c8.line+1,ch:_74(cm,_c8.line+1)};var _cc=cm.getRange(_c8,tmp);_cc=_cc.replace(/\n\s*/g," ");cm.replaceRange(_cc,_c8,tmp);}var _cd={line:_c8.line,ch:_cb};cm.setCursor(_cd);});},newLineAndEnterInsertMode:function(cm,_ce){var _cf=cm.getCursor();if(_cf.line===0&&!_ce.after){cm.replaceRange("\n",{line:0,ch:0});cm.setCursor(0,0);}else{_cf.line=(_ce.after)?_cf.line:_cf.line-1;_cf.ch=_74(cm,_cf.line);cm.setCursor(_cf);var _d0=CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent;_d0(cm);}this.enterInsertMode(cm);},paste:function(cm,_d1,vim){var cur=cm.getCursor();var _d2=_22().registerController.getRegister(_d1.registerName);if(!_d2.text){return;}for(var _d3="",i=0;i<_d1.repeat;i++){_d3+=_d2.text;}var _d4=_d2.linewise;if(_d4){if(_d1.after){_d3="\n"+_d3.slice(0,_d3.length-1);cur.ch=_74(cm,cur.line);}else{cur.ch=0;}}else{cur.ch+=_d1.after?1:0;}cm.replaceRange(_d3,cur);var _d5;var idx;if(_d4&&_d1.after){_d5={line:cur.line+1,ch:_9a(cm.getLine(cur.line+1))};}else{if(_d4&&!_d1.after){_d5={line:cur.line,ch:_9a(cm.getLine(cur.line))};}else{if(!_d4&&_d1.after){idx=cm.indexFromPos(cur);_d5=cm.posFromIndex(idx+_d3.length-1);}else{idx=cm.indexFromPos(cur);_d5=cm.posFromIndex(idx+_d3.length);}}}cm.setCursor(_d5);},undo:function(cm,_d6){_d7(cm,CodeMirror.commands.undo,_d6.repeat)();},redo:function(cm,_d8){_d7(cm,CodeMirror.commands.redo,_d8.repeat)();},setRegister:function(cm,_d9,vim){vim.inputState.registerName=_d9.selectedCharacter;},setMark:function(cm,_da,vim){var _db=_da.selectedCharacter;if(!_20(_db,_12)){return;}if(vim.marks[_db]){vim.marks[_db].clear();}vim.marks[_db]=cm.setBookmark(cm.getCursor());},replace:function(cm,_dc){var _dd=_dc.selectedCharacter;var _de=cm.getCursor();var _df=cm.getLine(_de.line);var _e0=_de.ch+_dc.repeat;if(_e0>_df.length){return;}var _e1={line:_de.line,ch:_e0};var _e2="";for(var i=0;i<_e1.ch-_de.ch;i++){_e2+=_dd;}cm.replaceRange(_e2,_de,_e1);cm.setCursor(_c2(_e1,0,-1));}};var _a5={"w":function(cm,_e3){return _5d(cm,_e3,true,false);},"W":function(cm,_e4){return _5d(cm,_e4,true,true);},"{":function(cm,_e5){return _e6(cm,"}",_e5);},"(":function(cm,_e7){return _e6(cm,")",_e7);},"[":function(cm,_e8){return _e6(cm,"]",_e8);},"'":function(cm,_e9){return _ea(cm,"'",_e9);},"\"":function(cm,_eb){return _ea(cm,"\"",_eb);}};function _75(cm,cur,_ec){var _ed=Math.min(Math.max(0,cur.line),cm.lineCount()-1);var _ee=_74(cm,_ed)-1;_ee=(_ec)?_ee+1:_ee;var ch=Math.min(Math.max(0,cur.ch),_ee);return {line:_ed,ch:ch};};function _ef(to,_f0){for(var _f1 in _f0){if(_f0.hasOwnProperty(_f1)){to[_f1]=_f0[_f1];}}};function _44(_f2){var ret={};for(var _f3 in _f2){if(_f2.hasOwnProperty(_f3)){ret[_f3]=_f2[_f3];}}return ret;};function _c2(cur,_f4,_f5){return {line:cur.line+_f4,ch:cur.ch+_f5};};function _f6(a1,a2){if(a1.length!=a2.length){return false;}for(var i=0;i<a1.length;i++){if(a1[i]!=a2[i]){return false;}}return true;};function _41(_f7,_f8){for(var i=0;i<_f7.length;i++){if(_f7[i]!=_f8[i]&&_f8[i]!="character"){return false;}}return true;};function _f9(_fa,big){for(var i=0;i<_fa.length;i++){if(_fa[i]!=big[i]){return false;}}return true;};function _d7(cm,fn,_fb){return function(){for(var i=0;i<_fb;i++){fn(cm);}};};function _6d(cur){return {line:cur.line,ch:cur.ch};};function _2a(_fc,_fd){return _fc.ch==_fd.ch&&_fc.line==_fd.line;};function _73(_fe,_ff){if(_fe.line<_ff.line){return true;}else{if(_fe.line==_ff.line&&_fe.ch<_ff.ch){return true;}}return false;};function _74(cm,_100){return cm.getLine(_100).length;};function _101(s){return s.split("").reverse().join("");};function trim(s){if(s.trim){return s.trim();}else{return s.replace(/^\s+|\s+$/g,"");}};function _60(s){return s.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1");};function _29(cm,vim){vim.visualMode=false;vim.visualLine=false;var _102=cm.getCursor("anchor");var _103=cm.getCursor("head");if(!_2a(_102,_103)){cm.setCursor(_75(cm,_103));}};function _79(cm,_104,_105){var _106=cm.getRange(_104,_105);var _107=_106.split("\n");if(_107.length>1&&_1d(_107.pop())){_105.line--;_105.ch=_74(cm,_105.line);}};function _78(cm,_108,_109){_108.ch=0;_109.ch=0;_109.line++;};function _9a(text){if(!text){return 0;}var _10a=text.search(/\S/);return _10a==-1?text.length:_10a;};function _5d(cm,_10b,_10c,_10d,_10e){var cur=cm.getCursor();var line=cm.getLine(cur.line);var idx=cur.ch;var _10f=line.substring(idx);var _110;if(_10e){_110=_10f.search(/\w/);}else{_110=_10f.search(/\S/);}if(_110==-1){return null;}idx+=_110;_10f=line.substring(idx);var _111=line.substring(0,idx);var _112;if(_10d){_112=/^\S+/;}else{if((/\w/).test(line.charAt(idx))){_112=/^\w+/;}else{_112=/^[^\w\s]+/;}}var _113=_112.exec(_10f);var _114=idx;var _115=idx+_113[0].length-1;var _116=_112.exec(_101(_111));if(_116){_114-=_116[0].length;}if(_10b){_115++;}return {start:{line:cur.line,ch:_114},end:{line:cur.line,ch:_115}};};function _117(cm,cur,_118,_119){var _11a=cur.line;var pos=cur.ch;var line=cm.getLine(_11a);var dir=_118?1:-1;var _11b=_119?_7:_6;while(true){var stop=(dir>0)?line.length:-1;var _11c=stop,_11d=stop;while(pos!=stop){var _11e=false;for(var i=0;i<_11b.length&&!_11e;++i){if(_11b[i].test(line.charAt(pos))){_11c=pos;while(pos!=stop&&_11b[i].test(line.charAt(pos))){pos+=dir;}_11d=pos;_11e=_11c!=_11d;if(_11c==cur.ch&&_11a==cur.line&&_11d==_11c+dir){continue;}else{return {from:Math.min(_11c,_11d+1),to:Math.max(_11c,_11d),line:_11a};}}}if(!_11e){pos+=dir;}}_11a+=dir;if(!_15(cm,_11a)){return null;}line=cm.getLine(_11a);pos=(dir>0)?0:line.length;}throw "The impossible happened.";};function _8c(cm,_11f,_120,_121,_122){var cur=cm.getCursor();for(var i=0;i<_11f;i++){var _123=cur.ch,_124=cur.line,word;var _125=false;while(!_125){word=_117(cm,cur,_120,_122);_125=true;if(word){cur.line=word.line;if(_120&&_121){cur.ch=word.to-1;}else{if(_120&&!_121){if(_1e(cur.ch,word.from,word.to)&&word.line==_124){_125=false;cur.ch=word.to-1;}else{cur.ch=word.from;}}else{if(!_120&&_121){if(_1e(cur.ch,word.from,word.to)&&word.line==_124){_125=false;cur.ch=word.from;}else{cur.ch=word.to;}}else{if(!_120&&!_121){cur.ch=word.from;}}}}}else{if(_120){return {line:cur.line,ch:_74(cm,cur.line)};}else{return {line:cur.line,ch:0};}}}}return cur;};function _90(cm,_126,_127,_128){var cur=cm.getCursor();var _129=cur.ch;var idx;for(var i=0;i<_126;i++){var line=cm.getLine(cur.line);idx=_12a(_129,line,_128,_127,true);if(idx==-1){return cur;}_129=idx;}return {line:cm.getCursor().line,ch:idx};};function _96(cm,_12b){var line=cm.getCursor().line;return _75(cm,{line:line,ch:_12b-1});};function _12a(_12c,line,_12d,_12e,_12f){var idx;if(_12e){idx=line.indexOf(_12d,_12c+1);if(idx!=-1&&!_12f){idx-=1;}}else{idx=line.lastIndexOf(_12d,_12c-1);if(idx!=-1&&!_12f){idx+=1;}}return idx;};function _9e(cm,cur,symb){var line=cur.line;symb=symb?symb:cm.getLine(line).charAt(cur.ch);var _130=_20(symb,["(","[","{"]);var _131=({"(":")",")":"(","[":"]","]":"[","{":"}","}":"{"})[symb];if(!_131){return cur;}var _132=({"(":1,"{":1,"[":1})[symb]||-1;var _133=1,_134=symb,_135=cur.ch,_136=cm.getLine(line);while(_134&&_133>0){_135+=_132;_134=_136.charAt(_135);if(!_134){line+=_132;_135=0;_136=cm.getLine(line)||"";_134=_136.charAt(_135);}if(_134===symb){_133++;}else{if(_134===_131){_133--;}}}if(_134){return {line:line,ch:_135};}return cur;};function _e6(cm,_137,_138){var cur=cm.getCursor();var end=_9e(cm,cur,_137);var _139=_9e(cm,end);_139.ch+=_138?1:0;end.ch+=_138?0:1;return {start:_139,end:end};};function _13a(_13b,_13c,_13d){for(var i=!_13d?_13b.length:_13d;i>=0;--i){if(_13c.test(_13b.charAt(i))){return i;}}return -1;};function _ea(cm,symb,_13e){var cur=cm.getCursor();var line=cm.getLine(cur.line);var _13f=line.split("");var _140,end,i,len;var _141=_13f.indexOf(symb);if(cur.ch<_141){cur.ch=_141;}else{if(_141<cur.ch&&_13f[cur.ch]==symb){end=cur.ch;--cur.ch;}}if(_13f[cur.ch]==symb&&!end){_140=cur.ch+1;}else{for(i=cur.ch;i>-1&&!_140;i--){if(_13f[i]==symb){_140=i+1;}}}if(_140&&!end){for(i=_140,len=_13f.length;i<len&&!end;i++){if(_13f[i]==symb){end=i;}}}if(!_140||!end){return {start:cur,end:cur};}if(_13e){--_140;++end;}return {start:{line:cur.line,ch:_140},end:{line:cur.line,ch:end}};};function _142(){this.marked=null;};_142.prototype={getQuery:function(){return _22().query;},setQuery:function(_143){_22().query=_143;},getMarked:function(){return this.marked;},setMarked:function(_144){this.marked=_144;},isReversed:function(){return _22().isReversed;},setReversed:function(_145){_22().isReversed=_145;}};function _52(cm){var vim=_24(cm);return vim.searchState_||(vim.searchState_=new _142());};function _146(cm,text,_147,_148){if(cm.openDialog){cm.openDialog(text,_148,{bottom:true});}else{_148(prompt(_147,""));}};function _149(str){var _14a=false;var _14b=[];for(var i=0;i<str.length;i++){var c=str.charAt(i);if(!_14a&&c=="/"){_14b.push(i);}_14a=(c=="\\");}return _14b;};function _14c(cm,_14d,_14e,_14f){var _150=_149(_14d);var _151;var _152;if(!_150.length){_151=_14d;}else{_151=_14d.substring(0,_150[0]);var _153=_14d.substring(_150[0]);_152=(_153.indexOf("i")!=-1);}if(!_151){return null;}if(_14f){_14e=(/^[^A-Z]*$/).test(_151);}try{var _154=new RegExp(_151,(_14e||_152)?"i":undefined);return _154;}catch(e){_155(cm,"Invalid regex: "+_151);}};function _155(cm,text){if(cm.openConfirm){cm.openConfirm("<span style=\"color: red\">"+text+"</span> <button type=\"button\">OK</button>",function(){},{bottom:true});}else{alert(text);}};function _156(_157,desc){var raw="";if(_157){raw+="<span style=\"font-family: monospace\">"+_157+"</span>";}raw+="<input type=\"text\"/> "+"<span style=\"color: #888\">";if(desc){raw+="<span style=\"color: #888\">";raw+=desc;raw+="</span>";}return raw;};var _5b="(Javascript regexp)";function _5a(cm,_158,_159,desc){var _15a=(_159||"")+" "+(desc||"");_146(cm,_156(_159,desc),_15a,_158);};function _15b(r1,r2){if(r1 instanceof RegExp&&r2 instanceof RegExp){var _15c=["global","multiline","ignoreCase","source"];for(var i=0;i<_15c.length;i++){var prop=_15c[i];if(r1[prop]!==r2[prop]){return (false);}}return (true);}return (false);};function _15d(cm,_15e,_15f,_160){cm.operation(function(){var _161=_52(cm);if(!_15e){return;}var _162=_14c(cm,_15e,!!_15f,!!_160);if(!_162){return;}if(_15b(_162,_161.getQuery())){return;}_be(cm);_163(cm,_162);_161.setQuery(_162);});};function _163(cm,_164){if(cm.lineCount()<2000){var _165=[];for(var _166=cm.getSearchCursor(_164);_166.findNext();){_165.push(cm.markText(_166.from(),_166.to(),{className:"CodeMirror-searching"}));}_52(cm).setMarked(_165);}};function _7d(cm,prev,_167){return cm.operation(function(){var _168=_52(cm);var _169=_168.getQuery();if(!_169){return;}if(!_168.getMarked()){_163(cm,_169);}var pos=cm.getCursor();prev=(_168.isReversed())?!prev:prev;if(!prev){pos.ch+=1;}var _16a=cm.getSearchCursor(_169,pos);for(var i=0;i<_167;i++){if(!_16a.find(prev)){_16a=cm.getSearchCursor(_169,(prev)?{line:cm.lineCount()-1}:{line:0,ch:0});if(!_16a.find(prev)){return;}}}return _16a.from();});};function _be(cm){cm.operation(function(){var _16b=_52(cm);if(!_16b.getQuery()){return;}var _16c=_16b.getMarked();if(!_16c){return;}for(var i=0;i<_16c.length;++i){_16c[i].clear();}_16b.setMarked(null);});};var _16d=[{name:"map",type:"builtIn"},{name:"write",shortName:"w",type:"builtIn"},{name:"undo",shortName:"u",type:"builtIn"},{name:"redo",shortName:"red",type:"builtIn"}];var _16e=function(){this.buildCommandMap_();};_16e.prototype={processCommand:function(cm,_16f){var _170=this.parseInput_(_16f);var _171;if(!_170.commandName){if(_170.line!==undefined){_171="move";}}else{var _172=this.matchCommand_(_170.commandName);if(_172){_171=_172.name;if(_172.type=="exToKey"){for(var i=0;i<_172.toKeys.length;i++){vim.handleKey(cm,_172.toKeys[i]);}return;}else{if(_172.type=="exToEx"){this.processCommand(cm,_172.toInput);return;}}}}if(!_171){_155(cm,"Not an editor command \":"+_16f+"\"");return;}_173[_171](cm,_170);},parseInput_:function(_174){var _175={};_175.input=_174;var idx=0;var _176=(/^:+/).exec(_174);if(_176){idx+=_176[0].length;}var _177=(/^(\d+)/).exec(_174.substring(idx));if(_177){_175.line=parseInt(_177[1],10);idx+=_177[0].length;}var _178=(/^(\w+)/).exec(_174.substring(idx));if(_178){_175.commandName=_178[1];idx+=_178[1].length;}var args=trim(_174.substring(idx)).split(/\s+/);if(args.length&&args[0]){_175.commandArgs=args;}return _175;},matchCommand_:function(_179){for(var i=_179.length;i>0;i--){var _17a=_179.substring(0,i);if(this.commandMap_[_17a]){var _17b=this.commandMap_[_17a];if(_17b.name.indexOf(_179)===0){return _17b;}}}return null;},buildCommandMap_:function(){this.commandMap_={};for(var i=0;i<_16d.length;i++){var _17c=_16d[i];var key=_17c.shortName||_17c.name;this.commandMap_[key]=_17c;}},map:function(lhs,rhs){if(lhs.charAt(0)==":"){var _17d=lhs.substring(1);if(rhs.charAt(0)==":"){this.commandMap_[_17d]={name:_17d,type:"exToEx",toInput:rhs.substring(1)};}else{this.commandMap_[_17d]={name:_17d,type:"exToKey",toKeys:_17e(rhs)};}}else{if(rhs.charAt(0)==":"){_1.unshift({keys:_17e(lhs),type:"keyToEx",exArgs:{input:rhs.substring(1)}});}else{_1.unshift({keys:_17e(lhs),type:"keyToKey",toKeys:_17e(rhs)});}}}};function _17e(str){var idx=0;var keys=[];while(idx<str.length){if(str.charAt(idx)!="<"){keys.push(str.charAt(idx));idx++;continue;}var _17f=++idx;while(str.charAt(idx++)!=">"){}var _180=str.substring(_17f,idx-1);var _181=(/^C-(.+)$/).exec(_180);if(_181){var key;switch(_181[1]){case "BS":key="Backspace";break;case "CR":key="Enter";break;case "Del":key="Delete";break;default:key=_181[1];break;}keys.push("Ctrl-"+key);}}return keys;};var _173={map:function(cm,_182){var _183=_182.commandArgs;if(!_183||_183.length<2){if(cm){_155(cm,"Invalid mapping: "+_182.input);}return;}_27.map(_183[0],_183[1],cm);},move:function(cm,_184){_2b.processMotion(cm,_24(cm),{motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,repeat:_184.line}});},redo:CodeMirror.commands.redo,undo:CodeMirror.commands.undo,write:function(cm){if(CodeMirror.commands.save){CodeMirror.commands.save(cm);}else{cm.save();}}};var _27=new _16e();function _185(){function _186(cm,key,_187){if(_1a(key)){if(_187=="Shift"){_187=null;}else{key=key.toLowerCase();}}if(_187){key=_187+"-"+key;}vim.handleKey(cm,key);};function _188(key,_189){return function(cm){_186(cm,key,_189);};};var _18a=["Shift","Ctrl"];var _18b={"nofallthrough":true,"style":"fat-cursor"};function _18c(keys,_18d){for(var i=0;i<keys.length;i++){var key=keys[i];if(!_18d&&_20(key,_10)){key="'"+key+"'";}if(_18d){_18b[_18d+"-"+key]=_188(keys[i],_18d);}else{_18b[key]=_188(keys[i]);}}};_18c(_c);_18c(_c,"Shift");_18c(_c,"Ctrl");_18c(_10);_18c(_10,"Ctrl");_18c(_e);_18c(_e,"Ctrl");_18c(_11);_18c(_11,"Ctrl");return _18b;};CodeMirror.keyMap.vim=_185();function _18e(cm){cm.setCursor(cm.getCursor().line,cm.getCursor().ch-1,true);cm.setOption("keyMap","vim");};CodeMirror.keyMap["vim-insert"]={"Esc":_18e,"Ctrl-[":_18e,"Ctrl-C":_18e,"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete","Enter":function(cm){var fn=CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent;fn(cm);},fallthrough:["default"]};return _26;};var vim=_2();CodeMirror.Vim=vim;})();