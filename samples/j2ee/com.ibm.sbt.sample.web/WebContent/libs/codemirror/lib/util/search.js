/*  (c) Copyright IBM Corp. 2010 - Licensed under the Apache License, Version 2.0 */

(function(){function _1(){this.posFrom=this.posTo=this.query=null;this.marked=[];};function _2(cm){return cm._searchState||(cm._searchState=new _1());};function _3(cm,_4,_5){return cm.getSearchCursor(_4,_5,typeof _4=="string"&&_4==_4.toLowerCase());};function _6(cm,_7,_8,f){if(cm.openDialog){cm.openDialog(_7,f);}else{f(prompt(_8,""));}};function _9(cm,_a,_b,fs){if(cm.openConfirm){cm.openConfirm(_a,fs);}else{if(confirm(_b)){fs[0]();}}};function _c(_d){var _e=_d.match(/^\/(.*)\/([a-z]*)$/);return _e?new RegExp(_e[1],_e[2].indexOf("i")==-1?"":"i"):_d;};var _f="Search: <input type=\"text\" style=\"width: 10em\"/> <span style=\"color: #888\">(Use /re/ syntax for regexp search)</span>";function _10(cm,rev){var _11=_2(cm);if(_11.query){return _12(cm,rev);}_6(cm,_f,"Search for:",function(_13){cm.operation(function(){if(!_13||_11.query){return;}_11.query=_c(_13);if(cm.lineCount()<2000){for(var _14=_3(cm,_11.query);_14.findNext();){_11.marked.push(cm.markText(_14.from(),_14.to(),{className:"CodeMirror-searching"}));}}_11.posFrom=_11.posTo=cm.getCursor();_12(cm,rev);});});};function _12(cm,rev){cm.operation(function(){var _15=_2(cm);var _16=_3(cm,_15.query,rev?_15.posFrom:_15.posTo);if(!_16.find(rev)){_16=_3(cm,_15.query,rev?{line:cm.lineCount()-1}:{line:0,ch:0});if(!_16.find(rev)){return;}}cm.setSelection(_16.from(),_16.to());_15.posFrom=_16.from();_15.posTo=_16.to();});};function _17(cm){cm.operation(function(){var _18=_2(cm);if(!_18.query){return;}_18.query=null;for(var i=0;i<_18.marked.length;++i){_18.marked[i].clear();}_18.marked.length=0;});};var _19="Replace: <input type=\"text\" style=\"width: 10em\"/> <span style=\"color: #888\">(Use /re/ syntax for regexp search)</span>";var _1a="With: <input type=\"text\" style=\"width: 10em\"/>";var _1b="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";function _1c(cm,all){_6(cm,_19,"Replace:",function(_1d){if(!_1d){return;}_1d=_c(_1d);_6(cm,_1a,"Replace with:",function(_1e){if(all){cm.operation(function(){for(var _1f=_3(cm,_1d);_1f.findNext();){if(typeof _1d!="string"){var _20=cm.getRange(_1f.from(),_1f.to()).match(_1d);_1f.replace(_1e.replace(/\$(\d)/,function(_21,i){return _20[i];}));}else{_1f.replace(_1e);}}});}else{_17(cm);var _22=_3(cm,_1d,cm.getCursor());function _23(){var _24=_22.from(),_25;if(!(_25=_22.findNext())){_22=_3(cm,_1d);if(!(_25=_22.findNext())||(_24&&_22.from().line==_24.line&&_22.from().ch==_24.ch)){return;}}cm.setSelection(_22.from(),_22.to());_9(cm,_1b,"Replace?",[function(){_26(_25);},_23]);};function _26(_27){_22.replace(typeof _1d=="string"?_1e:_1e.replace(/\$(\d)/,function(_28,i){return _27[i];}));_23();};_23();}});});};CodeMirror.commands.find=function $DBbv_(cm){_17(cm);_10(cm);};CodeMirror.commands.findNext=_10;CodeMirror.commands.findPrev=function $DBbw_(cm){_10(cm,true);};CodeMirror.commands.clearSearch=_17;CodeMirror.commands.replace=_1c;CodeMirror.commands.replaceAll=function $DBbx_(cm){_1c(cm,true);};})();