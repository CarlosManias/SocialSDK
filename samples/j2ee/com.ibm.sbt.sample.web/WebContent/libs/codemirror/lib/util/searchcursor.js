/*  (c) Copyright IBM Corp. 2010 - Licensed under the Apache License, Version 2.0 */

(function(){function _1(cm,_2,_3,_4){this.atOccurrence=false;this.cm=cm;if(_4==null&&typeof _2=="string"){_4=false;}_3=_3?cm.clipPos(_3):{line:0,ch:0};this.pos={from:_3,to:_3};if(typeof _2!="string"){if(!_2.global){_2=new RegExp(_2.source,_2.ignoreCase?"ig":"g");}this.matches=function $DBby_(_5,_6){if(_5){_2.lastIndex=0;var _7=cm.getLine(_6.line).slice(0,_6.ch),_8=_2.exec(_7),_9=0;while(_8){_9+=_8.index+1;_7=_7.slice(_9);_2.lastIndex=0;var _a=_2.exec(_7);if(_a){_8=_a;}else{break;}}_9--;}else{_2.lastIndex=_6.ch;var _7=cm.getLine(_6.line),_8=_2.exec(_7),_9=_8&&_8.index;}if(_8){return {from:{line:_6.line,ch:_9},to:{line:_6.line,ch:_9+_8[0].length},match:_8};}};}else{if(_4){_2=_2.toLowerCase();}var _b=_4?function(_c){return _c.toLowerCase();}:function(_d){return _d;};var _e=_2.split("\n");if(_e.length==1){this.matches=function $DBbz_(_f,pos){var _10=_b(cm.getLine(pos.line)),len=_2.length,_11;if(_f?(pos.ch>=len&&(_11=_10.lastIndexOf(_2,pos.ch-len))!=-1):(_11=_10.indexOf(_2,pos.ch))!=-1){return {from:{line:pos.line,ch:_11},to:{line:pos.line,ch:_11+len}};}};}else{this.matches=function $DBb0_(_12,pos){var ln=pos.line,idx=(_12?_e.length-1:0),_13=_e[idx],_14=_b(cm.getLine(ln));var _15=(_12?_14.indexOf(_13)+_13.length:_14.lastIndexOf(_13));if(_12?_15>=pos.ch||_15!=_13.length:_15<=pos.ch||_15!=_14.length-_13.length){return;}for(;;){if(_12?!ln:ln==cm.lineCount()-1){return;}_14=_b(cm.getLine(ln+=_12?-1:1));_13=_e[_12?--idx:++idx];if(idx>0&&idx<_e.length-1){if(_14!=_13){return;}else{continue;}}var _16=(_12?_14.lastIndexOf(_13):_14.indexOf(_13)+_13.length);if(_12?_16!=_14.length-_13.length:_16!=_13.length){return;}var _17={line:pos.line,ch:_15},end={line:ln,ch:_16};return {from:_12?end:_17,to:_12?_17:end};}};}}};_1.prototype={findNext:function(){return this.find(false);},findPrevious:function(){return this.find(true);},find:function(_18){var _19=this,pos=this.cm.clipPos(_18?this.pos.from:this.pos.to);function _1a(_1b){var pos={line:_1b,ch:0};_19.pos={from:pos,to:pos};_19.atOccurrence=false;return false;};for(;;){if(this.pos=this.matches(_18,pos)){this.atOccurrence=true;return this.pos.match||true;}if(_18){if(!pos.line){return _1a(0);}pos={line:pos.line-1,ch:this.cm.getLine(pos.line-1).length};}else{var _1c=this.cm.lineCount();if(pos.line==_1c-1){return _1a(_1c);}pos={line:pos.line+1,ch:0};}}},from:function(){if(this.atOccurrence){return this.pos.from;}},to:function(){if(this.atOccurrence){return this.pos.to;}},replace:function(_1d){var _1e=this;if(this.atOccurrence){_1e.pos.to=this.cm.replaceRange(_1d,_1e.pos.from,_1e.pos.to);}}};CodeMirror.defineExtension("getSearchCursor",function(_1f,pos,_20){return new _1(this,_1f,pos,_20);});})();