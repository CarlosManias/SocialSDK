<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.ibm.sbt.test</groupId>
  <artifactId>startcargo</artifactId>
  <version>1.0.0</version>
  <packaging>pom</packaging>

  <parent>
    <groupId>com.ibm.sbt.test</groupId>
    <artifactId>test.parent</artifactId>
    <version>1.0.0</version>
    <relativePath>../</relativePath>
  </parent>

  <dependencies>
    <dependency>
      <groupId>com.ibm.sbt.sdk</groupId>
      <artifactId>sbt</artifactId>
      <version>1.0.0</version>
      <type>war</type>
    </dependency>
    <dependency>
      <groupId>com.ibm.sbt.sdk</groupId>
      <artifactId>sbt.dojo180</artifactId>
      <version>1.0.0</version>
      <type>war</type>
    </dependency>
    <dependency>
      <groupId>com.ibm.sbt.sample</groupId>
      <artifactId>sbt.sample.web</artifactId>
      <version>1.0.0</version>
      <type>war</type>
    </dependency>
    <dependency>
      <groupId>com.ibm.sbt.sample</groupId>
      <artifactId>acme.social.sample.dataapp</artifactId>
      <version>1.0.0</version>
      <type>war</type>
    </dependency>
    <dependency>
      <groupId>com.ibm.sbt.sample</groupId>
      <artifactId>acme.social.sample.webapp</artifactId>
      <version>1.0.0</version>
      <type>war</type>
    </dependency>
    <dependency>
      <groupId>com.ibm.sbt.test</groupId>
      <artifactId>sbt.jasmine.web</artifactId>
      <version>1.0.0</version>
      <type>war</type>
    </dependency>
  </dependencies>

  <build>
    <plugins>
      <!-- CARGO PLUGIN START -->
      <plugin>
         <groupId>org.codehaus.cargo</groupId>
         <artifactId>cargo-maven2-plugin</artifactId>
         <version>${cargo.version}</version>
         <configuration>
          <container>
            <containerId>tomcat7x</containerId>
            <zipUrlInstaller>
              <url>http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.35/bin/apache-tomcat-7.0.35.zip</url>
              <!--<url>http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.32/bin/apache-tomcat-7.0.32.zip</url>-->
              <downloadDir>${project.target.directory}/downloads</downloadDir>
              <extractDir>${project.target.directory}/extracts</extractDir>
            </zipUrlInstaller>
            <!-- <timeout>30000</timeout> -->
            <output>${project.target.directory}/tomcat7x/container.log</output>
            <append>false</append>
            <log>${project.target.directory}/tomcat7x/cargo.log</log>
          </container>
          <configuration>
            <type>standalone</type>
            <home>${project.target.directory}/catalina-base</home>
            <properties>
              <cargo.servlet.port>${servlet.port}</cargo.servlet.port>
            </properties>
            <files>
              <file>
                <file>${project.target.directory}/com.ibm.sbt.sdk/com.ibm.commons.runtime/com.ibm.commons.runtime.jar</file>
                <todir>lib</todir>
              </file>
              <file>
                <file>${project.prereqs.directory}/eclipse/plugins/com.ibm.sbt.libs.j2ee/lib/commons-logging-1.1.1.jar</file>
                <todir>lib</todir>
              </file>
              <file>
                <file>${project.platform.directory}/tomcat/keystore</file>
                <todir>conf</todir>
              </file>
            </files>
            <configfiles>
              <configfile>
                <file>${project.platform.directory}/tomcat/context.xml</file>
                <todir>conf</todir>
              </configfile>
              <configfile>
                <file>${project.platform.directory}/tomcat/tomcat-users.xml</file>
                <todir>conf</todir>
              </configfile>
              <configfile>
                <file>${project.platform.directory}/tomcat/server.xml</file>
                <todir>conf</todir>
              </configfile>
              <configfile>
                <file>${project.config.directory}/sbt.properties</file>
                <todir>conf</todir>
              </configfile>
            </configfiles>
          </configuration>
          <deployables>
            <deployable>
              <groupId>com.ibm.sbt.sdk</groupId>
              <artifactId>sbt</artifactId>
              <type>war</type>
              <properties>
                <context>/sbt</context>
              </properties>
            </deployable>
            <deployable>
              <groupId>com.ibm.sbt.sdk</groupId>
              <artifactId>sbt.dojo180</artifactId>
              <type>war</type>
              <properties>
                <context>/sbt.dojo180</context>
              </properties>
            </deployable>
            <deployable>
              <groupId>com.ibm.sbt.sample</groupId>
              <artifactId>sbt.sample.web</artifactId>
              <type>war</type>
              <properties>
                <context>/sbt.sample.web</context>
              </properties>
            </deployable>
            <deployable>
              <groupId>com.ibm.sbt.sample</groupId>
              <artifactId>acme.social.sample.dataapp</artifactId>
              <type>war</type>
              <properties>
                <context>/acme.social.sample.dataapp</context>
              </properties>
            </deployable>
            <deployable>
              <groupId>com.ibm.sbt.sample</groupId>
              <artifactId>acme.social.sample.webapp</artifactId>
              <type>war</type>
              <properties>
                <context>/acme.social.sample</context>
              </properties>
            </deployable>
            <deployable>
              <groupId>com.ibm.sbt.test</groupId>
              <artifactId>sbt.jasmine.web</artifactId>
              <type>war</type>
              <properties>
                <context>/sbt.jasmine.web</context>
              </properties>
            </deployable>
          </deployables> 
          <packager>
            <outputLocation>${project.target.directory}/tomcat-packaged</outputLocation>
          </packager>
         </configuration>
         <executions>
          <execution>
            <id>start</id>
            <phase>pre-integration-test</phase>
            <goals>
              <goal>start</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
      <!-- CARGO PLUGIN END-->
    </plugins>
  </build>
</project>
